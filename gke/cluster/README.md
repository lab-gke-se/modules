# Google Kubernetes Engine Cluster

## Usage

```HCL
cluster_files = fileset("${path.module}/config/clusters", "*.yaml")
cluster_configs = {
  for filename in local.cluster_files : replace(filename, ".yaml", "") => yamldecode(templatefile("${path.module}/config/clusters/${filename}", local.substitutions))
}

module "cluster" {
  source = "gke/cluster"
  for_each = local.cluster_configs

  name = each.value.name
}
```

<!-- BEGIN_TF_DOCS -->
## Requirements

| Name | Version |
|------|---------|
| <a name="requirement_google"></a> [google](#requirement\_google) | < 5.44.0 |

## Providers

| Name | Version |
|------|---------|
| <a name="provider_google"></a> [google](#provider\_google) | < 5.44.0 |

## Modules

No modules.

## Resources

| Name | Type |
|------|------|
| [google_container_cluster.primary](https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/container_cluster) | resource |
| [google_container_engine_versions.region](https://registry.terraform.io/providers/hashicorp/google/latest/docs/data-sources/container_engine_versions) | data source |

## Inputs

| Name | Description | Type | Default | Required |
|------|-------------|------|---------|:--------:|
| <a name="input_addonsConfig"></a> [addonsConfig](#input\_addonsConfig) | The configuration for addons supported by GKE | <pre>object({<br/>    dnsCacheConfig = optional(object({<br/>      enabled = optional(bool, null)<br/>    }), null)<br/>    gcePersistentDiskCsiDriverConfig = optional(object({<br/>      enabled = optional(bool, null)<br/>    }), null)<br/>    gcpFilestoreCsiDriverConfig = optional(object({<br/>      enabled = optional(bool, null)<br/>    }), null)<br/>    gcsFuseCsiDriverConfig = optional(object({<br/>      enabled = optional(bool, null)<br/>    }), null)<br/>    horizontalPodAutoscaling = optional(object({<br/>      disabled = optional(bool, null)<br/>    }), null)<br/>    httpLoadBalancing = optional(object({<br/>      disabled = optional(bool, null)<br/>    }), null)<br/>    kubernetesDashboard = optional(object({<br/>      enabled = optional(bool, null)<br/>    }), null)<br/>    networkPolicyConfig = optional(object({<br/>      disabled = optional(bool, null)<br/>    }), null)<br/>    statefulHaConfig = optional(object({<br/>      enabled = optional(bool, null)<br/>    }), null)<br/>    cloudrunConfig = optional(object({<br/>      disabled         = optional(bool, null)<br/>      loadBalancerType = optional(string, null)<br/>    }), null)<br/>    gkeBackupAgentConfig = optional(object({<br/>      enabled = optional(bool, null)<br/>    }), null)<br/>    configConnectorConfig = optional(object({<br/>      enabled = optional(bool, null)<br/>    }), null)<br/>    rayOperatorConfig = optional(object({<br/>      enabled = optional(bool, null)<br/>      rayClusterLoggingConfig = optional(object({<br/>        enabled = optional(bool, null)<br/>      }), null)<br/>      rayClusterMonitoringConfig = optional(object({<br/>        enabled = optional(bool, null)<br/>      }), null)<br/>    }), null)<br/>    # kubernetesDashboard = optional(object({}), null) Deprecated<br/>  })</pre> | `null` | no |
| <a name="input_autopilot"></a> [autopilot](#input\_autopilot) | Enable autopilot for this cluster, default in GKE is false | <pre>object({<br/>    enabled = optional(bool, null)<br/>  })</pre> | `null` | no |
| <a name="input_autoscaling"></a> [autoscaling](#input\_autoscaling) | Configuration of Node Auto-Provisioning with Cluster Autoscaler for this cluster | <pre>object({<br/>    autoprovisioningNodePoolDefaults = optional(object({<br/>      bootDiskKmsKey = optional(string, null)<br/>      diskType       = optional(string, null)<br/>      diskSize       = optional(string, null)<br/>      imageType      = optional(string, null)<br/>      management = optional(object({<br/>        autoRepair  = optional(bool, null)<br/>        autoUpgrade = optional(bool, null)<br/>      }), null)<br/>      oauthScopes    = optional(list(string), null)<br/>      serviceAccount = optional(string, null)<br/>      upgradeSettings = optional(object({<br/>        maxSurge = optional(number, null)<br/>        strategy = optional(string, null)<br/>      }), null)<br/>    }), null)<br/>    autoscalingProfile         = optional(string, null)<br/>    enableNodeAutoProvisioning = optional(bool, null)<br/>    resourceLimits = optional(list(object({<br/>      resourceType = string<br/>      minimum      = optional(string, null)<br/>      maximum      = optional(string, null)<br/>    })), null)<br/>  })</pre> | `null` | no |
| <a name="input_binaryAuthorization"></a> [binaryAuthorization](#input\_binaryAuthorization) | Configuration options for the Binary Authorization feature | `object({})` | `null` | no |
| <a name="input_clusterIpv4Cidr"></a> [clusterIpv4Cidr](#input\_clusterIpv4Cidr) | The IP address range of the Kubernetes pods in this cluster in CIDR notation | `string` | `null` | no |
| <a name="input_currentMasterVersion"></a> [currentMasterVersion](#input\_currentMasterVersion) | The current version of the master | `string` | `null` | no |
| <a name="input_currentNodeVersion"></a> [currentNodeVersion](#input\_currentNodeVersion) | The current version of the nodes | `string` | `null` | no |
| <a name="input_databaseEncryption"></a> [databaseEncryption](#input\_databaseEncryption) | Encyption settings for etcd | <pre>object({<br/>    # currentState = optional(string, null)<br/>    state   = optional(string, null)<br/>    keyName = optional(string, null)<br/>  })</pre> | `null` | no |
| <a name="input_defaultMaxPodsConstraint"></a> [defaultMaxPodsConstraint](#input\_defaultMaxPodsConstraint) | n/a | <pre>object({<br/>    maxPodsPerNode = optional(number, null)<br/>  })</pre> | `null` | no |
| <a name="input_deletion_protection"></a> [deletion\_protection](#input\_deletion\_protection) | Whether or not to allow Terraform to destroy the cluster | `bool` | `false` | no |
| <a name="input_description"></a> [description](#input\_description) | The description of the cluster | `string` | `null` | no |
| <a name="input_fleet"></a> [fleet](#input\_fleet) | fleet | <pre>object({<br/>    membership = optional(string, null)<br/>    project    = optional(string, null)<br/>  })</pre> | n/a | yes |
| <a name="input_initialClusterVersion"></a> [initialClusterVersion](#input\_initialClusterVersion) | The minimum version of the master | `string` | `null` | no |
| <a name="input_initialNodeCount"></a> [initialNodeCount](#input\_initialNodeCount) | initial Node Count | `number` | `null` | no |
| <a name="input_ipAllocationPolicy"></a> [ipAllocationPolicy](#input\_ipAllocationPolicy) | The allocation policy for the ip ranges | <pre>object({<br/>    useIpAliases               = optional(bool, null)<br/>    createSubnetwork           = optional(bool, null)<br/>    subnetworkName             = optional(string, null)<br/>    clusterIpv4Cidr            = optional(string, null)<br/>    nodeIpv4Cidr               = optional(string, null)<br/>    servicesIpv4Cidr           = optional(string, null)<br/>    clusterSecondaryRangeName  = optional(string, null)<br/>    servicesSecondaryRangeName = optional(string, null)<br/>    clusterIpv4CidrBlock       = optional(string, null)<br/>    nodeIpv4CidrBlock          = optional(string, null)<br/>    servicesIpv4CidrBlock      = optional(string, null)<br/>    tpuIpv4CidrBlock           = optional(string, null)<br/>    useRoutes                  = optional(bool, null)<br/>    stackType                  = optional(string, null)<br/>    ipv6AccessType             = optional(string, null)<br/>    podCidrOverprovisionConfig = optional(object({<br/>      disable = optional(bool, null)<br/>    }), null)<br/>    subnetIpv6CidrBlock   = optional(string, null)<br/>    servicesIpv6CidrBlock = optional(string, null)<br/>    additionalPodRangesConfig = optional(object({<br/>      podRangeNames = optional(list(string), null)<br/>      podRangeInfo = optional(list(object({<br/>        rangeName   = optional(string, null)<br/>        utilization = optional(number, null)<br/>      })), null)<br/>    }), null)<br/>    defaultPodIpv4RangeUtilization = optional(number, null)<br/>  })</pre> | n/a | yes |
| <a name="input_labelFingerprint"></a> [labelFingerprint](#input\_labelFingerprint) | Label Fingerprint | `string` | `null` | no |
| <a name="input_legacyAbac"></a> [legacyAbac](#input\_legacyAbac) | Configuration for the legacy Attribute Based Access Control authorization mode | <pre>object({<br/>    enabled = optional(bool, null)<br/>  })</pre> | `null` | no |
| <a name="input_location"></a> [location](#input\_location) | The location of the cluster for regional clusters | `string` | `null` | no |
| <a name="input_locations"></a> [locations](#input\_locations) | The zones for the nodes or single zone for a zonal cluster | `list(string)` | `null` | no |
| <a name="input_loggingConfig"></a> [loggingConfig](#input\_loggingConfig) | Logging configuration for the cluster | <pre>object({<br/>    componentConfig = optional(object({<br/>      enableComponents = optional(list(string), null)<br/>    }), null)<br/>  })</pre> | `null` | no |
| <a name="input_loggingService"></a> [loggingService](#input\_loggingService) | The logging service that the cluster should write logs to | `string` | `null` | no |
| <a name="input_maintenancePolicy"></a> [maintenancePolicy](#input\_maintenancePolicy) | The maintenance policy to use for the cluster | <pre>object({<br/>    window = optional(object({<br/>      recurringWindow = optional(object({<br/>        recurrence = optional(string, null)<br/>        window = optional(object({<br/>          startTime = optional(string, null)<br/>          endTime   = optional(string, null)<br/>        }), null)<br/>      }), null)<br/>      dailyMaintenanceWindow = optional(object({<br/>        duration  = optional(string, null)<br/>        startTime = optional(string, null)<br/>      }), null)<br/>      maintenanceExclusions = optional(map(object({<br/>        startTime = optional(string, null)<br/>        endTime   = optional(string, null)<br/>        maintenanceExclusionOptions = optional(object({<br/>          scope = optional(string, null)<br/>        }), null)<br/>      })), null)<br/>    }), null)<br/>  })</pre> | `null` | no |
| <a name="input_masterAuth"></a> [masterAuth](#input\_masterAuth) | The authentication information for accessing the Kubernetes master | <pre>object({<br/>    clientCertificateConfig = optional(object({<br/>      issueClientCertificate = optional(bool, null)<br/>    }), null)<br/>    clusterCaCertificate = optional(string, null) # output only<br/>    clientCertificate    = optional(string, null) # output only<br/>    clientKey            = optional(string, null) # output only<br/>  })</pre> | `null` | no |
| <a name="input_masterAuthorizedNetworksConfig"></a> [masterAuthorizedNetworksConfig](#input\_masterAuthorizedNetworksConfig) | The desired configuration options for master authorized networks | <pre>object({<br/>    cidrBlocks = optional(list(object({<br/>      cidrBlock   = string<br/>      displayName = optional(string, null)<br/>    })))<br/>    enabled                     = optional(bool, null)<br/>    gcpPublicCidrsAccessEnabled = optional(bool, null)<br/>  })</pre> | `null` | no |
| <a name="input_monitoringConfig"></a> [monitoringConfig](#input\_monitoringConfig) | Monitoring configuration for the cluster | <pre>object({<br/>    advancedDatapathObservabilityConfig = optional(object({<br/>      enableMetrics = optional(bool, null)<br/>    }), null)<br/>    componentConfig = optional(object({<br/>      enableComponents = optional(list(string), null)<br/>    }), null)<br/>    managedPrometheusConfig = optional(object({<br/>      enabled = optional(bool, null)<br/>    }), null)<br/>  })</pre> | `null` | no |
| <a name="input_monitoringService"></a> [monitoringService](#input\_monitoringService) | he monitoring service that the cluster should write metrics to | `string` | `null` | no |
| <a name="input_name"></a> [name](#input\_name) | The name of the cluster | `string` | n/a | yes |
| <a name="input_network"></a> [network](#input\_network) | The network for the cluster | `string` | n/a | yes |
| <a name="input_networkConfig"></a> [networkConfig](#input\_networkConfig) | The network configuration for the cluster | <pre>object({<br/>    datapathProvider = optional(string, null)<br/>    defaultSnatStatus = optional(object({<br/>      disabled = optional(bool, null)<br/>    }), null)<br/>    dnsConfig = optional(object({<br/>      clusterDns       = optional(string, null)<br/>      clusterDnsDomain = optional(string, null)<br/>      clusterDnsScope  = optional(string, null)<br/>    }), null)<br/>    enableIntraNodeVisibility = optional(bool, null)<br/>    gatewayApiConfig = optional(object({<br/>      channel = optional(string, null)<br/>    }), null)<br/>    network = optional(string, null)<br/>    serviceExternalIpsConfig = optional(object({<br/>      enabled = optional(bool, null)<br/>    }), null)<br/>    subnetwork = optional(string, null)<br/>  })</pre> | `null` | no |
| <a name="input_networkPolicy"></a> [networkPolicy](#input\_networkPolicy) | Configuration options for the NetworkPolicy feature. | <pre>object({<br/>    provider = optional(string, null)<br/>    enabled  = optional(bool, null)<br/>  })</pre> | `null` | no |
| <a name="input_nodeConfig"></a> [nodeConfig](#input\_nodeConfig) | Parameters that describe the nodes in a cluster | <pre>object({<br/>    machineType    = optional(string, null)<br/>    diskSizeGb     = optional(number, null)<br/>    oauthScopes    = optional(list(string), null)<br/>    serviceAccount = optional(string)<br/>    metadata       = optional(map(string))<br/>    imageType      = optional(string, null)<br/>    labels         = optional(map(string), null)<br/>    localSsdCount  = optional(number, null)<br/>    tags           = optional(list(string), null)<br/>    preemptible    = optional(bool, null)<br/>    accelerators = optional(list(object({<br/>      acceleratorCount = optional(string, null)<br/>      acceleratorType  = optional(string, null)<br/>      gpuPartitionSize = optional(string, null)<br/>      gpuSharingConfig = optional(object({<br/>        maxSharedClientsPerGpu = optional(string, null)<br/>        gpuSharingStrategy     = optional(string, null)<br/>      }), null)<br/>      gpuDriverInstallationConfig = optional(object({<br/>        gpuDriverVersion = optional(string, null)<br/>      }), null)<br/>    })), null)<br/>    diskType       = optional(string, null)<br/>    minCpuPlatform = optional(string, null)<br/>    workloadMetadataConfig = optional(object({<br/>      mode = optional(string, null)<br/>    }), null)<br/>    taints = optional(list(object({<br/>      key    = optional(string, null)<br/>      value  = optional(string, null)<br/>      effect = optional(string, null)<br/>    })), null)<br/>    sandboxConfig = optional(object({<br/>      type = optional(string, null)<br/>    }), null)<br/>    nodeGroup = optional(string, null)<br/>    reservationAffinity = optional(object({<br/>      consumeReservationType = optional(string, null)<br/>      key                    = optional(string, null)<br/>      values                 = optional(list(string), null)<br/>    }), null)<br/>    shieldedInstanceConfig = optional(object({<br/>      enableSecureBoot          = optional(bool, null)<br/>      enableIntegrityMonitoring = optional(bool, null)<br/>    }), null)<br/>    linuxNodeConfig = optional(object({<br/>      sysctls    = optional(map(string), null)<br/>      cgroupMode = optional(string, null)<br/>      hugepages = optional(object({<br/>        hugepageSize2m = optional(number, null)<br/>        hugepageSize1g = optional(number, null)<br/>      }), null)<br/>    }), null)<br/>    kubeletConfig = optional(object({<br/>      cpuManagerPolicy                   = optional(string, null)<br/>      cpuCfsQuota                        = optional(bool, null)<br/>      cpuCfsQuotaPeriod                  = optional(string, null)<br/>      podPidsLimit                       = optional(string, null)<br/>      insecureKubeletReadonlyPortEnabled = optional(bool, null)<br/>    }), null)<br/>    bootDiskKmsKey = optional(string, null)<br/>    gcfsConfig = optional(object({<br/>      enabled = optional(bool, null)<br/>    }), null)<br/>    advancedMachineFeatures = optional(object({<br/>      threadsPerCore             = optional(string, null)<br/>      enableNestedVirtualization = optional(bool, null)<br/>    }), null)<br/>    gvnic = optional(object({<br/>      enabled = optional(bool, null)<br/>    }), null)<br/>    spot = optional(bool, null)<br/>    confidentialNodes = optional(object({<br/>      enabled = optional(bool, null)<br/>    }), null)<br/>    resourceLabels = optional(map(string), null)<br/>    loggingConfig = optional(object({<br/>      variantConfig = optional(object({<br/>        variant = optional(string, null)<br/>      }), null)<br/>    }), null)<br/>    windowsNodeConfig = optional(object({<br/>      osVersion = optional(string, null)<br/>    }), null)<br/>    localNvmeSsdBlockConfig = optional(object({<br/>      localSsdCount = optional(number, null)<br/>    }), null)<br/>    ephemeralStorageLocalSsdConfig = optional(object({<br/>      localSsdCount = optional(number, null)<br/>    }), null)<br/>    soleTenantConfig = optional(object({<br/>      nodeAffinities = optional(list(object({<br/>        key      = optional(string, null)<br/>        operator = optional(string, null)<br/>        values   = optional(list(string), null)<br/>      })), null)<br/>    }), null)<br/>    containerdConfig = optional(object({<br/>      privateRegistryAccessConfig = optional(object({<br/>        enabled = optional(bool, null)<br/>        certificateAuthorityDomainConfig = optional(list(object({<br/>          fqdns = optional(list(string), null)<br/>          gcpSecretManagerCertificateConfig = optional(object({<br/>            secretUri = optional(string, null)<br/>          }), null)<br/>        })), null)<br/>      }), null)<br/>    }), null)<br/>    hostMaintenancePolicy = optional(object({<br/>      maintenanceInterval = optional(string, null)<br/>      opportunisticMaintenanceStrategy = optional(object({<br/>        nodeIdleTimeWindow            = optional(string, null)<br/>        maintenanceAvailabilityWindow = optional(string, null)<br/>        minNodesPerPool               = optional(string, null)<br/>      }), null)<br/>    }), null)<br/>    resourceManagerTags = optional(object({<br/>      tags = optional(map(string), null)<br/>    }), null)<br/>    enableConfidentialStorage = optional(bool, null)<br/>    secondaryBootDisks = optional(list(object({<br/>      mode      = optional(string, null)<br/>      diskImage = optional(string, null)<br/>    })), null)<br/>    fastSocket = optional(object({<br/>      enabled = optional(bool, null)<br/>    }), null)<br/>    secondaryBootDiskUpdateStrategy = optional(object({}), null) # Oddly TBD<br/>  })</pre> | `null` | no |
| <a name="input_nodePoolDefaults"></a> [nodePoolDefaults](#input\_nodePoolDefaults) | Default NodePool settings for the entire cluster | <pre>object({<br/>    nodeConfigDefaults = optional(object({<br/>      containerdConfig = optional(object({<br/>        privateRegistryAccessConfig = optional(object({<br/>          certificateAuthorityDomainConfig = optional(list(object({<br/>            fqdns = optional(list(string), null)<br/>            gcpSecretManagerCertificateConfig = optional(object({<br/>              secretURI = optional(string, null)<br/>            }), null)<br/>          })), null)<br/>        }), null)<br/>      }), null)<br/>      gcfsConfig = optional(object({<br/>        enabled = optional(bool, null)<br/>      }), null)<br/>      loggingConfig = optional(object({<br/>        variantConfig = optional(object({<br/>          variant = optional(string, null)<br/>        }), null)<br/>      }), null)<br/>      nodeKubeletConfig = optional(object({<br/>        insecureKubeletReadonlyPortEnabled = optional(bool, null)<br/>      }), null)<br/>    }), null)<br/>  })</pre> | `null` | no |
| <a name="input_notificationConfig"></a> [notificationConfig](#input\_notificationConfig) | Configuration for the cluster upgrade notifications feature | <pre>object({<br/>    pubsub = optional(object({}), null)<br/>  })</pre> | `null` | no |
| <a name="input_privateClusterConfig"></a> [privateClusterConfig](#input\_privateClusterConfig) | The private configuration of the cluster | <pre>object({<br/>    enablePrivateEndpoint     = optional(bool, false)<br/>    enablePrivateNodes        = optional(bool, false)<br/>    masterIpv4CidrBlock       = optional(string, null)<br/>    privateEndpointSubnetwork = optional(string, null)<br/>    masterGlobalAccessConfig = optional(object({<br/>      enabled = optional(bool, false)<br/>    }), null)<br/>  })</pre> | `null` | no |
| <a name="input_project"></a> [project](#input\_project) | The project for the cluster | `string` | n/a | yes |
| <a name="input_releaseChannel"></a> [releaseChannel](#input\_releaseChannel) | The release channel for the cluster | <pre>object({<br/>    channel = optional(string, null)<br/>  })</pre> | `null` | no |
| <a name="input_remove_default_node_pool"></a> [remove\_default\_node\_pool](#input\_remove\_default\_node\_pool) | Remove default nodes? | `bool` | `true` | no |
| <a name="input_resourceLabels"></a> [resourceLabels](#input\_resourceLabels) | The GCE resource labels (a map of key/value pairs) to be applied to the cluster | `map(string)` | `null` | no |
| <a name="input_securityPostureConfig"></a> [securityPostureConfig](#input\_securityPostureConfig) | Enable/Disable Security Posture API features for the cluster | <pre>object({<br/>    mode              = optional(string, null)<br/>    vulnerabilityMode = optional(string, null)<br/>  })</pre> | `null` | no |
| <a name="input_shieldedNodes"></a> [shieldedNodes](#input\_shieldedNodes) | Enable Shielded Nodes features on all nodes in this cluster | <pre>object({<br/>    enabled = optional(bool, null)<br/>  })</pre> | `null` | no |
| <a name="input_subnetwork"></a> [subnetwork](#input\_subnetwork) | The subnetwork for the nodes | `string` | `null` | no |
| <a name="input_timeouts"></a> [timeouts](#input\_timeouts) | Terraform timeout values | `object({})` | `null` | no |
| <a name="input_verticalPodAutoscaling"></a> [verticalPodAutoscaling](#input\_verticalPodAutoscaling) | Enable vertical pod autoscaling | <pre>object({<br/>    enabled = optional(bool, null)<br/>  })</pre> | `null` | no |
| <a name="input_workloadIdentityConfig"></a> [workloadIdentityConfig](#input\_workloadIdentityConfig) | Workload Identity allows Kubernetes service accounts to act as a user-managed Google IAM Service Account | <pre>object({<br/>    workloadPool = optional(string, null)<br/>  })</pre> | `null` | no |

## Outputs

No outputs.
<!-- END_TF_DOCS -->